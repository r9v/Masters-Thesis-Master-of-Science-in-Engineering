(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     28679,        788]
NotebookOptionsPosition[     28155,        767]
NotebookOutlinePosition[     28500,        782]
CellTagsIndexPosition[     28457,        779]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell[BoxData[{
 RowBox[{
  RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Clear", "[", "Derivative", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Remove", "[", "\"\<Global`*\>\"", "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\n", 
 RowBox[{
  RowBox[{"q", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", "q1", "}"}], ",", 
     RowBox[{"{", "q2", "}"}], ",", 
     RowBox[{"{", "q3", "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"q", "'"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"q1", "'"}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"q2", "'"}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"q3", "'"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"qx", "'"}], "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"q1x", "'"}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"q2x", "'"}], "}"}], ",", " ", 
     RowBox[{"{", 
      RowBox[{"q3x", "'"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"q", "''"}], "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"q1", "''"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"q2", "''"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"q3", "''"}], "}"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Mm", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"(", 
          RowBox[{"1", "/", "3"}], ")"}], "m2", "*", 
         RowBox[{"l2", "^", "2"}]}], "+", 
        RowBox[{"m3", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"l2", "^", "2"}], "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"1", "/", "3"}], ")"}], 
            RowBox[{"l3", "^", "2"}], "*", 
            RowBox[{
             RowBox[{"Cos", "[", "q3", "]"}], "^", "2"}]}], "+", 
           RowBox[{"l2", "*", "l3", "*", 
            RowBox[{"Cos", "[", "q3", "]"}]}]}], ")"}]}]}], ",", "0", ",", 
       "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"m2", "+", "m3"}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "/", "2"}], ")"}], "*", "m3", "*", "l2", "*", "l3", "*", 
        RowBox[{"Cos", "[", "q3", "]"}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "/", "2"}], ")"}], "*", "m3", "*", "l2", "*", "l3", "*", 
        RowBox[{"Cos", "[", "q3", "]"}]}], ",", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"1", "/", "3"}], ")"}], "*", "m3", "*", 
        RowBox[{"l3", "^", "2"}]}]}], "}"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Cm", "=", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"q3", "'"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"-", "1"}], "/", "2"}], 
           RowBox[{"(", 
            RowBox[{"m3", "*", "l2", "*", "l3", "*", 
             RowBox[{"Sin", "[", "q3", "]"}]}], ")"}]}], "-", 
          RowBox[{
           RowBox[{"1", "/", "3"}], 
           RowBox[{"(", 
            RowBox[{"m3", "*", 
             RowBox[{"l3", "^", "2"}], 
             RowBox[{"Sin", "[", "q3", "]"}], 
             RowBox[{"Cos", "[", "q3", "]"}]}], ")"}]}]}], ")"}]}], ",", "0", 
       ",", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"q1", "'"}]}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"1", "/", "2"}], 
           RowBox[{"(", 
            RowBox[{"m3", "*", "l2", "*", "l3", "*", 
             RowBox[{"Sin", "[", "q3", "]"}]}], ")"}]}], "+", 
          RowBox[{
           RowBox[{"1", "/", "3"}], 
           RowBox[{"(", 
            RowBox[{"m3", "*", 
             RowBox[{"l3", "^", "2"}], 
             RowBox[{"Sin", "[", "q3", "]"}], 
             RowBox[{"Cos", "[", "q3", "]"}]}], ")"}]}]}], ")"}]}]}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"0", " ", ",", "0", ",", 
       RowBox[{"0", " ", "-", 
        RowBox[{
         RowBox[{"q3", "'"}], " ", 
         RowBox[{"1", "/", "2"}], " ", "m3", " ", "l2", " ", "l3", " ", 
         RowBox[{"Sin", "[", "q3", "]"}]}]}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"q1", "'"}], 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"1", "/", "2"}], " ", "m3", " ", "l2", " ", "l3", " ", 
           RowBox[{"Sin", "[", "q3", "]"}]}], "+", 
          RowBox[{
           RowBox[{"1", "/", "3"}], " ", "m3", " ", 
           RowBox[{"l3", "^", "2"}], " ", 
           RowBox[{"Sin", "[", "q3", "]"}], " ", 
           RowBox[{"Cos", "[", "q3", "]"}]}]}], ")"}]}], ",", "0", " ", ",", 
       "0"}], "}"}]}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Dm", "=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"{", "0", "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"m2", "+", "m3"}], ")"}], "g"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"1", "/", "2"}], " ", "g", " ", "m3", " ", "l3", " ", 
        RowBox[{"Cos", "[", "q3", "]"}]}], "}"}]}], "}"}]}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dyn", "=", 
   RowBox[{
    RowBox[{"Mm", ".", 
     RowBox[{"q", "''"}]}], "+", 
    RowBox[{"Cm", ".", 
     RowBox[{"qx", "'"}]}], "+", "Dm"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"dynExpanded", "=", 
   RowBox[{"ExpandAll", "[", "dyn", "]"}]}], " ", 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MmExpanded", "=", 
   RowBox[{"ExpandAll", "[", "Mm", "]"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CmExpanded", "=", 
   RowBox[{"ExpandAll", "[", "Cm", "]"}]}], " ", ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DmExpanded", "=", 
    RowBox[{"ExpandAll", "[", "Dm", "]"}]}], " ", ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"params", "=", 
    RowBox[{"{", " ", 
     RowBox[{
      RowBox[{"l3", " ", "m3", " ", "l2"}], " ", "\[Rule]", 
      RowBox[{"2", "a1"}]}], "}"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParamDyn", "=", 
   RowBox[{"ReplaceRepeated", "[", 
    RowBox[{"dynExpanded", ",", "params"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Simplify", "[", "ParamDyn", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CoefficientArrays", "[", 
   RowBox[{"ParamDyn", ",", 
    RowBox[{"{", "a1", "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"M", "=", 
   RowBox[{"Normal", "[", 
    RowBox[{"%", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"M", "=", 
    RowBox[{"M", " ", "//.", 
     RowBox[{
      RowBox[{"{", "x_List", "}"}], "\[RuleDelayed]", " ", "x"}]}]}], "    ", 
   ";"}], "     "}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "[", 
    RowBox[{"M", ",", 
     RowBox[{"TableSpacing", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParamMm", "=", 
   RowBox[{"ReplaceRepeated", "[", 
    RowBox[{"MmExpanded", ",", "params"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Simplify", "[", "ParamMm", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"McoA", "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"ParamMm", ",", 
     RowBox[{"{", "a1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"M0", "=", 
   RowBox[{"Normal", "[", 
    RowBox[{"McoA", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"MatrixForm", "[", 
  RowBox[{"M0", ",", 
   RowBox[{"TableSpacing", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"M1", "=", 
   RowBox[{"Normal", "[", 
    RowBox[{"McoA", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "[", 
    RowBox[{"M1", ",", 
     RowBox[{"TableSpacing", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParamCm", "=", 
   RowBox[{"ReplaceRepeated", "[", 
    RowBox[{"CmExpanded", ",", "params"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Simplify", "[", "ParamCm", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"CcoA", "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"ParamCm", ",", 
     RowBox[{"{", "a1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C0", "=", 
   RowBox[{"Normal", "[", 
    RowBox[{"CcoA", "[", 
     RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"MatrixForm", "[", 
  RowBox[{"C0", ",", 
   RowBox[{"TableSpacing", "\[Rule]", 
    RowBox[{"{", 
     RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"C1", "=", 
   RowBox[{"Normal", "[", 
    RowBox[{"CcoA", "[", 
     RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatrixForm", "[", 
    RowBox[{"C1", ",", 
     RowBox[{"TableSpacing", "\[Rule]", 
      RowBox[{"{", 
       RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"ParamDm", "=", 
   RowBox[{"ReplaceRepeated", "[", 
    RowBox[{"DmExpanded", ",", "params"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Simplify", "[", "ParamDm", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DcoA", "=", 
   RowBox[{"CoefficientArrays", "[", 
    RowBox[{"ParamDm", ",", 
     RowBox[{"{", "a1", "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"MatrixForm", "[", 
   RowBox[{"DcoA", ",", 
    RowBox[{"TableSpacing", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"D0", "=", 
     RowBox[{"Normal", "[", 
      RowBox[{"DcoA", "[", 
       RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"MatrixForm", "[", 
      RowBox[{"D0", ",", 
       RowBox[{"TableSpacing", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}], "\[IndentingNewLine]", 
     RowBox[{"D1", "=", 
      RowBox[{"Normal", "[", 
       RowBox[{"DcoA", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"MatrixForm", "[", 
     RowBox[{"D1", ",", 
      RowBox[{"TableSpacing", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"2", ",", "2"}], "}"}]}]}], "]"}]}], "*)"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Y", "=", 
   TagBox[
    RowBox[{"(", "\[NoBreak]", GridBox[{
       {
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "q3", "]"}]}], " ", 
          SuperscriptBox["q1x", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3", "\[Prime]",
           MultilineFunction->None]}], "-", 
         RowBox[{
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         RowBox[{"2", " ", 
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]\[Prime]",
           MultilineFunction->None]}]}], 
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           FractionBox["1", "2"]}], " ", 
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1x", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3", "\[Prime]",
           MultilineFunction->None]}], "-", 
         RowBox[{
          FractionBox["1", "2"], " ", 
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3x", "\[Prime]",
           MultilineFunction->None]}]}], 
        SuperscriptBox["q1", "\[Prime]\[Prime]",
         MultilineFunction->None], "0", "0", 
        RowBox[{
         SuperscriptBox[
          RowBox[{"Cos", "[", "q3", "]"}], "2"], " ", 
         SuperscriptBox["q1", "\[Prime]\[Prime]",
          MultilineFunction->None]}], "0"},
       {
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "q3", "]"}]}], " ", 
          SuperscriptBox["q3", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         RowBox[{
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          SuperscriptBox["q3", "\[Prime]\[Prime]",
           MultilineFunction->None]}]}], "0", "0", "1", "1", "0", 
        SuperscriptBox["q2", "\[Prime]\[Prime]",
         MultilineFunction->None]},
       {
        RowBox[{
         RowBox[{
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q1x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         RowBox[{
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          SuperscriptBox["q2", "\[Prime]\[Prime]",
           MultilineFunction->None]}]}], 
        RowBox[{
         RowBox[{
          FractionBox["1", "2"], " ", 
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q1x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         FractionBox[
          SuperscriptBox["q3", "\[Prime]\[Prime]",
           MultilineFunction->None], "2"]}], "0", "0", 
        RowBox[{
         FractionBox["1", "2"], " ", "l3", " ", 
         RowBox[{"Cos", "[", "q3", "]"}]}], "0", "0"}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
    Function[BoxForm`e$, 
     MatrixForm[BoxForm`e$]]]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Ys", "=", 
    RowBox[{"(", GridBox[{
       {
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "q3", "]"}]}], " ", 
          SuperscriptBox["q1x", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3", "\[Prime]",
           MultilineFunction->None]}], "-", 
         RowBox[{
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         RowBox[{"2", " ", 
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]\[Prime]",
           MultilineFunction->None]}]}]},
       {
        RowBox[{
         RowBox[{
          RowBox[{"-", 
           RowBox[{"Sin", "[", "q3", "]"}]}], " ", 
          SuperscriptBox["q3", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q3x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         RowBox[{
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          SuperscriptBox["q3", "\[Prime]\[Prime]",
           MultilineFunction->None]}]}]},
       {
        RowBox[{
         RowBox[{
          RowBox[{"Sin", "[", "q3", "]"}], " ", 
          SuperscriptBox["q1", "\[Prime]",
           MultilineFunction->None], " ", 
          SuperscriptBox["q1x", "\[Prime]",
           MultilineFunction->None]}], "+", 
         RowBox[{
          RowBox[{"Cos", "[", "q3", "]"}], " ", 
          SuperscriptBox["q2", "\[Prime]\[Prime]",
           MultilineFunction->None]}]}]}
      },
      GridBoxAlignment->{
       "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
        "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
      GridBoxSpacings->{"Columns" -> {
          Offset[0.27999999999999997`], {
           Offset[0.7]}, 
          Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
          Offset[0.2], {
           Offset[0.4]}, 
          Offset[0.2]}, "RowsIndexed" -> {}}], ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"a", "=", 
   RowBox[{"{", 
    RowBox[{"{", "a1", "}"}], "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"invParams", "=", 
    RowBox[{"{", " ", 
     RowBox[{"a1", "\[Rule]", 
      RowBox[{"l3", " ", "m3", " ", 
       RowBox[{"l2", "/", "2"}]}]}], " ", "}"}]}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Simplify", "[", 
   RowBox[{"dyn", "-", 
    RowBox[{"ReplaceRepeated", "[", 
     RowBox[{
      RowBox[{"Ys", ".", "a"}], ",", "invParams"}], "]"}]}], "]"}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7197579504614267`*^9, 3.7197580029124265`*^9}, {
   3.7197580968938017`*^9, 3.7197581044052315`*^9}, {3.7197582314264965`*^9, 
   3.7197582504105825`*^9}, {3.7197583035476217`*^9, 
   3.7197583291460857`*^9}, {3.7197583946658335`*^9, 3.719758451937109*^9}, {
   3.7197585737630773`*^9, 3.7197585780733232`*^9}, {3.7197587462419424`*^9, 
   3.7197587957407737`*^9}, {3.7197589037829533`*^9, 3.719759013398223*^9}, {
   3.719759049414283*^9, 3.7197590829271994`*^9}, 3.7197592341248474`*^9, {
   3.719759461238838*^9, 3.7197595016121473`*^9}, {3.7197595621246085`*^9, 
   3.7197596872237635`*^9}, {3.7197597810561304`*^9, 3.719759894951645*^9}, 
   3.7197600246550636`*^9, {3.7197601322452173`*^9, 3.7197601984300027`*^9}, {
   3.7197602313608866`*^9, 3.719760236933205*^9}, {3.7197602998998065`*^9, 
   3.7197605018033547`*^9}, {3.719760534260211*^9, 3.7197605376214037`*^9}, 
   3.7197606635166044`*^9, {3.7197607138664837`*^9, 3.7197607911059017`*^9}, {
   3.7197608489782124`*^9, 3.719760945960759*^9}, {3.719760986969105*^9, 
   3.719761010087427*^9}, {3.7197615131482005`*^9, 3.719761516932417*^9}, {
   3.719761547780181*^9, 3.7197616035873733`*^9}, {3.719762875419118*^9, 
   3.71976288105544*^9}, {3.719816152231655*^9, 3.7198162124721003`*^9}, 
   3.719816424231212*^9, {3.719816965916195*^9, 3.719817006235501*^9}, {
   3.7198171171218433`*^9, 3.7198171658186283`*^9}, {3.7198171972744274`*^9, 
   3.719817334769292*^9}, {3.719817973469824*^9, 3.7198184075356507`*^9}, {
   3.7198184406835465`*^9, 3.719818948222576*^9}, {3.719819020935735*^9, 
   3.7198190299662514`*^9}, {3.7198191085727477`*^9, 3.719819132646125*^9}, 
   3.7198191790457783`*^9, {3.719819238260165*^9, 3.7198193100502715`*^9}, {
   3.719819528586771*^9, 3.7198195852710133`*^9}, {3.71981962420024*^9, 
   3.71981962594934*^9}, {3.7198196562470727`*^9, 3.719819675791191*^9}, {
   3.7198199031081924`*^9, 3.7198199307337723`*^9}, 3.719819991824267*^9, {
   3.7207108737599916`*^9, 3.720710899167445*^9}, {3.7207109397687674`*^9, 
   3.7207110651119366`*^9}, {3.7207111532861834`*^9, 
   3.7207111627417245`*^9}, {3.720711364147244*^9, 3.7207113942599664`*^9}, {
   3.7207114633419175`*^9, 3.720711685002596*^9}, {3.7207117156423483`*^9, 
   3.720711717872476*^9}, {3.7207117758427916`*^9, 3.720711875001463*^9}, {
   3.720711986815859*^9, 3.720712002958782*^9}, {3.7207121427437773`*^9, 
   3.7207121456549435`*^9}, {3.7207121816720037`*^9, 3.720712229925764*^9}, {
   3.7207122655518017`*^9, 3.72071234018207*^9}, {3.7207123851526423`*^9, 
   3.7207124342364497`*^9}, {3.7207125244126077`*^9, 3.720712575756544*^9}, {
   3.7208662371742773`*^9, 3.720866260351603*^9}, 3.7209682150058866`*^9}],

Cell[BoxData[
 TemplateBox[{
  "Remove","rmnsm",
   "\"There are no symbols matching \\\"\\!\\(\\*RowBox[{\\\"\\\\\\\"Global`*\
\\\\\\\"\\\"}]\\)\\\".\"",2,3,1,18811729626598023144,"Local"},
  "MessageTemplate"]], "Message", "MSG",
 CellChangeTimes->{3.7209682271265798`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       FractionBox[
        RowBox[{
         SuperscriptBox["l2", "2"], " ", "m2"}], "3"], "+", 
       RowBox[{
        SuperscriptBox["l2", "2"], " ", "m3"}], "+", 
       RowBox[{
        FractionBox["1", "3"], " ", 
        SuperscriptBox["l3", "2"], " ", "m3", " ", 
        SuperscriptBox[
         RowBox[{"Cos", "[", "q3", "]"}], "2"]}]}], "0", "0"},
     {"0", 
      RowBox[{"m2", "+", "m3"}], "0"},
     {"0", "0", 
      FractionBox[
       RowBox[{
        SuperscriptBox["l3", "2"], " ", "m3"}], "3"]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[1.4]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.8]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$, TableSpacing -> {2, 2}]]]], "Output",
 CellChangeTimes->{{3.7207118528071938`*^9, 3.720711876658558*^9}, {
   3.7207119886839657`*^9, 3.7207120047238827`*^9}, 3.7207121491281424`*^9, {
   3.720712191406561*^9, 3.720712231295842*^9}, {3.7207122910192585`*^9, 
   3.7207122972896166`*^9}, 3.7207123434382563`*^9, 3.7207124359945507`*^9, {
   3.7207125315830173`*^9, 3.720712577878666*^9}, {3.7208662444396925`*^9, 
   3.720866266921979*^9}, 3.7209682285676622`*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "3"]}], " ", 
       SuperscriptBox["l3", "2"], " ", "m3", " ", 
       RowBox[{"Cos", "[", "q3", "]"}], " ", 
       RowBox[{"Sin", "[", "q3", "]"}], " ", 
       SuperscriptBox["q3", "\[Prime]",
        MultilineFunction->None]}], "0", 
      RowBox[{
       RowBox[{"-", 
        FractionBox["1", "3"]}], " ", 
       SuperscriptBox["l3", "2"], " ", "m3", " ", 
       RowBox[{"Cos", "[", "q3", "]"}], " ", 
       RowBox[{"Sin", "[", "q3", "]"}], " ", 
       SuperscriptBox["q1", "\[Prime]",
        MultilineFunction->None]}]},
     {"0", "0", "0"},
     {
      RowBox[{
       FractionBox["1", "3"], " ", 
       SuperscriptBox["l3", "2"], " ", "m3", " ", 
       RowBox[{"Cos", "[", "q3", "]"}], " ", 
       RowBox[{"Sin", "[", "q3", "]"}], " ", 
       SuperscriptBox["q1", "\[Prime]",
        MultilineFunction->None]}], "0", "0"}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[1.4]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.8]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$, TableSpacing -> {2, 2}]]]], "Output",
 CellChangeTimes->{{3.7207118528071938`*^9, 3.720711876658558*^9}, {
   3.7207119886839657`*^9, 3.7207120047238827`*^9}, 3.7207121491281424`*^9, {
   3.720712191406561*^9, 3.720712231295842*^9}, {3.7207122910192585`*^9, 
   3.7207122972896166`*^9}, 3.7207123434382563`*^9, 3.7207124359945507`*^9, {
   3.7207125315830173`*^9, 3.720712577878666*^9}, {3.7208662444396925`*^9, 
   3.720866266921979*^9}, 3.720968228665668*^9}],

Cell[BoxData[
 TagBox[
  RowBox[{"(", "\[NoBreak]", GridBox[{
     {
      RowBox[{"(", "\[NoBreak]", 
       TagBox[GridBox[{
          {"0"}
         },
         GridBoxAlignment->{
          "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
           "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
         GridBoxSpacings->{"Columns" -> {
             Offset[0.27999999999999997`], {
              Offset[0.5599999999999999]}, 
             Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
             Offset[0.2], {
              Offset[0.4]}, 
             Offset[0.2]}, "RowsIndexed" -> {}}],
        Column], "\[NoBreak]", ")"}], 
      RowBox[{"(", "\[NoBreak]", 
       TagBox[GridBox[{
          {
           RowBox[{
            RowBox[{"g", " ", "m2"}], "+", 
            RowBox[{"g", " ", "m3"}]}]}
         },
         GridBoxAlignment->{
          "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
           "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
         GridBoxSpacings->{"Columns" -> {
             Offset[0.27999999999999997`], {
              Offset[0.5599999999999999]}, 
             Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
             Offset[0.2], {
              Offset[0.4]}, 
             Offset[0.2]}, "RowsIndexed" -> {}}],
        Column], "\[NoBreak]", ")"}], 
      RowBox[{"(", "\[NoBreak]", 
       TagBox[GridBox[{
          {
           RowBox[{
            FractionBox["1", "2"], " ", "g", " ", "l3", " ", "m3", " ", 
            RowBox[{"Cos", "[", "q3", "]"}]}]}
         },
         GridBoxAlignment->{
          "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, 
           "Rows" -> {{Baseline}}, "RowsIndexed" -> {}},
         GridBoxSpacings->{"Columns" -> {
             Offset[0.27999999999999997`], {
              Offset[0.5599999999999999]}, 
             Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
             Offset[0.2], {
              Offset[0.4]}, 
             Offset[0.2]}, "RowsIndexed" -> {}}],
        Column], "\[NoBreak]", ")"}]}
    },
    GridBoxAlignment->{
     "Columns" -> {{Center}}, "ColumnsIndexed" -> {}, "Rows" -> {{Baseline}}, 
      "RowsIndexed" -> {}},
    GridBoxSpacings->{"Columns" -> {
        Offset[0.27999999999999997`], {
         Offset[1.4]}, 
        Offset[0.27999999999999997`]}, "ColumnsIndexed" -> {}, "Rows" -> {
        Offset[0.2], {
         Offset[0.8]}, 
        Offset[0.2]}, "RowsIndexed" -> {}}], "\[NoBreak]", ")"}],
  Function[BoxForm`e$, 
   MatrixForm[BoxForm`e$, TableSpacing -> {2, 2}]]]], "Output",
 CellChangeTimes->{{3.7207118528071938`*^9, 3.720711876658558*^9}, {
   3.7207119886839657`*^9, 3.7207120047238827`*^9}, 3.7207121491281424`*^9, {
   3.720712191406561*^9, 3.720712231295842*^9}, {3.7207122910192585`*^9, 
   3.7207122972896166`*^9}, 3.7207123434382563`*^9, 3.7207124359945507`*^9, {
   3.7207125315830173`*^9, 3.720712577878666*^9}, {3.7208662444396925`*^9, 
   3.720866266921979*^9}, 3.7209682286756687`*^9}]
}, Open  ]],

Cell[BoxData[" "], "Input",
 CellChangeTimes->{3.7198174721361485`*^9}],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.719759822869522*^9, 3.7197598228865232`*^9}}]
},
WindowSize->{688, 812},
WindowMargins->{{Automatic, 0}, {Automatic, 0}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 20638, 563, 1369, "Input"],
Cell[21221, 587, 275, 6, 21, "Message"],
Cell[21499, 595, 1541, 39, 109, "Output"],
Cell[23043, 636, 1911, 47, 101, "Output"],
Cell[24957, 685, 3011, 73, 50, "Output"]
}, Open  ]],
Cell[27983, 761, 71, 1, 30, "Input"],
Cell[28057, 764, 94, 1, 30, "Input"]
}
]
*)

